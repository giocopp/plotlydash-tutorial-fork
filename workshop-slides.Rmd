---
title: "Interactive Graphs with Plotly and Dash"
subtitle: "IDS Workshop on interactive data visualization Plotly and Dash in R"
author: "Giorgio Coppola, Gayatri Shejwal, Lonny Chen"
institute: "Hertie School"
output:
  xaringan::moon_reader:
    css: [default,'simons-touch.css', metropolis, metropolis-fonts] 
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      eval = TRUE,
                      error = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      comment = NA)
```

```{r, include=F}
pacman::p_load(tidyverse, readr, ggplot2, plotly, dash, stringr, viridis)

# adding datasets
beers_original <- read_csv('./data/beers.csv')
toilets <- read_csv('./data/berliner-toiletten-standorte.csv')

# manuipulation
beers <- beers_original |>
  mutate(style_group = case_when(
    (str_detect(style, "IPA") ~ "IPA"),
    (str_detect(style, "Ale") ~ "Ale"),
    (str_detect(style, "Lager") | style == "Altbier" ~ "Lager"),
    (str_detect(style, "Pilsner") | str_detect(style, "Pilsener") ~ "Pilsner"),
    (str_detect(style, "Stout") ~ "Stout"),
    (str_detect(style, "Barleywine") ~ "Barleywine"),
    (str_detect(style, "Porter") ~ "Porter"),
    (str_detect(style, "Radler") | str_detect(style, "Fruit") ~ "Radler/Fruit"),
    .default = "Other"
    )
  )
```


class: inverse, center, middle
name: welcome

# Welcome!
<html><div style='float:left'></div><hr color='#EB811B' size=1px style="width:1000px; margin:auto;"/></html>

---
# Introduction

Data visualization is a powerful mean to understand complex data and communicate insights effectively, revealing the hidden patterns and trends that wouldn't be obvious in tabular data, turning raw data into information.

The tools we are going to introduce today serve exactly this purpose, enhancing the visualization possibilities offered by other static visualization packages such as `ggplot2`. 

<br>
--
**What tools allow to do so?**

Plotly and Dash! And we will introduce both!

Indeed, `plotly` and `dash` are `r emo::ji("dizzy")` interactive `r emo::ji("dizzy")`, in the sense that the user can interact with the data through the graph directly. This allows possibilities for higher understanding of the data. 

---
# Introduction
### Why interactive graphs?  `r emo::ji("metrics")`

--
<br>
* *Engagement*: Makes data come alive (interactive) and is more engaging for users. This increase understanding and retention.

--
* *Depth*: Allows users to drill down and explore nuances, as interaction allows to create narratives more easily. Users can ask 'why' and get answers instantly by exploring the chart or graph.

--
* *Decision-making*: Facilitates more informed decisions.

<br>
Both `plotly` and `dash` are interactive, but we can say that the level of interaction is different: `plotly` appears very similar to a static plot, with the difference that we can hover your cursor over it, accessing further data. `dash` on the other hand, creates proper dashboards, namely HTML apps, allowing even more interaction.

---
# Plotly
### What is Plotly?

--
Plotly is actually a company headquartered in Montreal, Canada, providing online graphing, analytics, and     statistics tools, as well as scientific graphing libraries for Python, R, MATLAB, Perl, Julia, Arduino, JavaScript and REST.
    
  In this contex, with Plotly we refer to the R package for to create interactive graphs.

--
### Advantages of using Plotly

--
- Seamless integration with R and `ggplot2`, through the `ggplotly()` function, that converts your static plots to an interactive web-based version!

--
- Diverse range of plots and customization (wide array of chart types with extensive customization options), as well as the possibility to zoom in and out into the plot, or select a certain part of the plot and explore it specifically.

--
- HTML web integration of graphs, makes visualization more accessible and intuitive. 


---
# Plotly
### Some visualization examples.

Some cool, non-trivial, yet not too complex, visualization that encapsulate the power of Plotly:
<br>
Let's play around a bit with the [Beer Consumption by US State Data](https://github.com/plotly/datasets/blob/master/beers.csv) `r emo::ji("beer")`!

We will create:
* blabla
* blabla
* blabla
* etc

---
class: custom-slide

<style>
.custom-slide .remark-code, .custom-slide .remark-inline-code {
    font-size: 14px;
}
</style>
# Plotly more in-deep
### Example 1: Histogram
Let's create a plotly graph plotting the 'alcohol by volume' (abv) variable against the beer 'count', to see the distribution of beer production in terms of alcohol level.
<br>

  .pull-left[
```{r}
fig1b <- beers %>% 
  plot_ly(x = ~abv, type = "histogram", name = "ABV") |>
  layout(
    title = "ABV Histogram",
    xaxis = list(title = "Alcohol by Volume (ABV)"),
    yaxis = list(title = "Count of beers"),
    bargap=0.2
  )
```
]

  .pull-right[
```{r, echo=F, fig.width = 6.75, fig.height = 5}
fig1b
```
]

---
class: custom-slide

<style>
.custom-slide .remark-code, .custom-slide .remark-inline-code {
    font-size: 14px;
}
</style>
# Plotly more in-deep
### Example 2: Boxplot
What about a boxplot showing alcool level against type of beer?

.pull-left[
```{r}
fig3a <- beers %>%
  plot_ly(x = ~abv, 
          color = ~style_group, 
          type = "box", 
          showlegend = T)
```
]

.pull-right[
```{r, echo=F, fig.width = 6.75, fig.height = 5}
fig3a
```
]

---
class: custom-slide

<style>
.custom-slide .remark-code, .custom-slide .remark-inline-code {
    font-size: 14px;
}
</style>

# Plotly more in-deep
### Example 3: Scatter plot
And what about alchool level against bitterness? We need a scatter plot!

.pull-left[
```{r}
fig4a <- beers |>
  plot_ly(x = ~abv, y = ~ibu, color = ~style_group, type = "scatter", mode = "markers",
          text = ~paste('Beer: ', beer, '</br>Style: ', style, '</br>Style Group: ', style_group)) |>
  layout(
    title = "Beers scatter plot: ABV vs. IBU",
    xaxis = list(title = "Alcohol by Volume (ABV)"),
    yaxis = list(title = "International Bitterness Units (IBU)")
  )
```
]


.pull-right[
<div align="center">
<br>
```{r, echo=F, fig.width = 6.75, fig.height = 5}
fig4a
```
</div>
]

---
class: custom-slide

<style>
.custom-slide .remark-code, .custom-slide .remark-inline-code {
    font-size: 12px;
}
</style>

# Plotly more in-deep
### ggplotly(): Transforming a ggplot graph into an interactive plotly graph!
We have a ggplot histogram that we want to transform into a plotly with ggplotly():

.pull-left[
```{r}
beers_clean <- beers_original %>%
    group_by(state) %>%
    summarize(
      total_beers = n(),
      ale_count = sum(str_detect(style, "Ale") | str_detect(style, "IPA")),
      ale_percentage = (ale_count / total_beers) * 100
    )
  
ggplot_1 <-  beers_clean %>%
    ggplot(aes(x = reorder(state, -ale_count))) +
    geom_bar(aes(y = total_beers, fill = "Total Beers"), stat = "identity", position = "dodge") +
    geom_bar(aes(y = ale_count, fill = "ALE Beers"), stat = "identity", position = "dodge") +
    coord_flip() +
    labs(title = "Comparison of Total Beers and ALE Beers by State",
         x = "State",
         y = "Count") +
    scale_fill_manual(values = c("Total Beers" = "gold", "ALE Beers" = "goldenrod"))
```
]

 .pull-right[
```{r, echo=F, fig.width = 6.75, fig.height = 5}
ggplot_1
```
]

---
class: custom-slide

<style>
.custom-slide .remark-code, .custom-slide .remark-inline-code {
    font-size: 10px;
}
</style>

# Plotly more in-deep
### ggplotly(): Transforming a ggplot graph into an interactive plotly graph!
Let's see:
Here, when you hover over the graph, you will be able to see the top 3 more alchoolic ALE style produced in every US state.

.pull-left[
```{r}
top_beers_by_state <- beers %>%
    group_by(state) %>%
    top_n(3, abv) %>%
    summarize(tooltip = paste(beer, "(", style, ")", collapse = "\n"))

top_ale_beers_by_state <- beers %>%
    filter(str_detect(style, "Ale") | str_detect(style, "IPA")) %>%
    group_by(state) %>%
    top_n(3, abv) %>%
    summarize(top_ale_tooltip = paste(beer, "(", style, ")", collapse = "\n"))

beers_clean_join <- beers_clean %>%
    left_join(top_beers_by_state, by = "state") %>%
    left_join(top_ale_beers_by_state, by = "state")

ggplot_2 <-  beers_clean_join %>%
    ggplot(aes(x = reorder(state, -ale_count))) +
    geom_bar(aes(y = total_beers, fill = "Total Beers", text = tooltip), stat = "identity", position = "dodge") +
    geom_bar(aes(y = ale_count, fill = "ALE Beers", text = top_ale_tooltip), stat = "identity", position = "dodge") +
    coord_flip() +
    labs(title = "Comparison of Total Beers and ALE Beers by State",
         x = "State",
         y = "Count") +
    scale_fill_manual(values = c("Total Beers" = "gold", "ALE Beers" = "goldenrod"))

plotly_graph_2 <- ggplotly(ggplot_2, tooltip = "text")
```
]

 .pull-right[
```{r, echo=F, fig.width = 6.75, fig.height = 5}
plotly_graph_2

```
]
---
# Dash
### What is Dash?

A web application framework for R (and Python and other programming languages) that allows creating interactive, web-based data dashboards (indeed), turning your interactive plots into full-blown web applications.

--
### Key features

--
- **HTML layout**: 
Design your dashboard layout using simple HTML components, without having to write any actual HTML. Indeed, it structure dashboard components using a set of pre-defined HTML tags within R.

--
- Interactivity through **callbacks**: 
callbacks define interactive behavior by specifying how input changes should modify output components. 
Essentially, when changing a dropdown or move a slider, a callback updates a chart, text, or any other component in real-time. 

--
- **Integration with Plotly** visualizations: Plotly charts can be easily included in Dash, making them part of an    
    interactive dashboard where each component can talk to others.

---
# Dash
### Some visualization examples.

A cool, non-trivial, yet not too complex, visualization that encapsulate the power of Dash:
<br>
Let's create a dash with a map of the public toilet in Berlin using the [Berlin Public Toilet Data](https://www.kaggle.com/datasets/ryanjt/berlin-public-toilets-location/) `r emo::ji("toilet")`, for example ???

---
class: inverse, center, middle, custom-hr
name: thank you

```{css, echo=FALSE} 
.custom-hr hr {
    border-color: #EB811B;
    width: 1000px;
    margin: auto;
    border-width: 1px 0 0 0;
}
```

# Thank you!

<div style="width:1000px; margin:auto;">
    <hr/>
</div>

Now... interactive tutorial!

You find the .Rmd file in the repository. Download it and open it in your R Studio, so that you can follow us directly and complete the exercises we prepared for you directly there!

<br>